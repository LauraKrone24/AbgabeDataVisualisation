<!DOCTYPE html>

<html>

    <head>
        <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.37.0/mapbox-gl.css" rel="stylesheet" />
        <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.37.0/mapbox-gl.js"></script>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/queue.v1.min.js"></script>
        <script src="https://d3js.org/d3-fetch.v1.min.js"></script>

        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    </head>

    <body>
        
        
        <div id = "Options">     
            <table>
                <tr>
                    <td>
                        Show
                        <div id="dropdownButtonHighAvgLow"></div>
                    </td>
                    <td>
                        Show
                        <div id="dropdownButtonOrginDestination"></div>
                    </td>
                </tr>
            </table> 
           
        </div>
        
        <div id="map"></div>
        <label>Hier Quellenangabe einf√ºgen</label>



        <script type="text/javascript">
            var HigAvgLow=2;
            var OrginDestination=1; 
            
            var dropdownButtonHighAvgLow = d3.select("#dropdownButtonHighAvgLow")
                .append('select')
                
            dropdownButtonHighAvgLow 
                .selectAll('myOptions') 
                .data([{text:"Highest Delay",value:1},{text:"Avg Delay",value:2},{text:"Lowest Delay",value:3}])
                .enter()
                .append('option')
                .text(function (d) { return d.text; }) 
                .attr("value", function (d) { return d.value; }) 

            dropdownButtonHighAvgLow.on("change", function(d) {
                let option = d3.select(this).property("value")
                HigAvgLow= option;
                load()
                })
                


            var dropdownButtonOrginDestination = d3.select("#dropdownButtonOrginDestination")
                .append('select')
                
            dropdownButtonOrginDestination
                .selectAll('myOptions') 
                .data([{text:"Origin Airport",value:1},{text:"Destination Airport",value:2}])
                .enter()
                .append('option')
                .text(function (d) { return d.text; }) 
                .attr("value", function (d) { return d.value; }) 

            dropdownButtonOrginDestination.on("change", function(d) {
                let option = d3.select(this).property("value")
                OrginDestination = option;
                load()
                })


            var view = "map"
            mapboxgl.accessToken = 'pk.eyJ1IjoibGF1cmFrcm8iLCJhIjoiY2xmbWx0cHEzMGQwNTN4bnA1Ync1eHI5cyJ9.RbCaC98XN7LIzk4pde9YbA'; 

            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/dark-v9',
                zoom: 3,
                center: [-104.386330, 43.753746]
            });

            
            function project(d) {
                return map.project(new mapboxgl.LngLat(+d[0], +d[1]));
            }

            
            function projectPoint(lon, lat) {
                var point = map.project(new mapboxgl.LngLat(lon, lat));
                return point

            }

            var canvas = map.getCanvasContainer();
            var svg = d3.select(canvas).append("svg");

            
            
            load()
            function load()
            {
                let orgAirportsDelay = "https://raw.githubusercontent.com/LauraKrone24/AbgabeDataVisualisation/master/OrigDelaySummary.csv"
                let destAirportsDelay = "https://raw.githubusercontent.com/LauraKrone24/AbgabeDataVisualisation/master/DestDelaySummary.csv"
                var CSVLink; 
                if(OrginDestination==1){CSVLink= orgAirportsDelay;}
                else{CSVLink= destAirportsDelay}
               
                console.log(CSVLink)
                svg.selectAll("*").remove()
                d3.csv(CSVLink,(x)=> {
                
                if (!x.AIRPORT_POS.includes('nan')) {
                 x.AIRPORT_POS = JSON.parse(x.AIRPORT_POS.replace(/\'/g, "\""))
                 return x}}).then(data=>{
                    var myColor = d3.scaleLinear().domain([60,-10])
                    .range(["red", "green"])
                    console.log(data)
                    var x = d3.scaleLinear()
                    .domain([0, 5])
                    .range([0, 1000]);

                    var y = d3.scaleLinear()
                        .domain([10, 0])
                        .range([0, 500]);
                    var line = d3.line()
                    .x((d) => x(d.x))
                    .y((d) => y(d.y))
                    
                    g = svg.selectAll("circle")
                    .data(data)
                    .enter()
                    .append('g')

                    g.append('circle')
                    .attr("cx", d => {
                        return projectPoint(d.AIRPORT_POS.lon, d.AIRPORT_POS.lat).x
                    })
                    .attr("cy", d => {
                        return projectPoint(d.AIRPORT_POS.lon, d.AIRPORT_POS.lat).y
                    })
                    .attr("r",d => { return d.Count })
                    .style('fill', d => {
                        
                        if(HigAvgLow==1) {return myColor(d.HighDelay) }
                        if(HigAvgLow==2) {return myColor(d.AvgDelay) }
                        if(HigAvgLow==3) {return myColor(d.LowDelay) }
                    })
                    .style("opacity",0)
                    .transition()
                    .delay(function (d, i) { return d.Hour * 1000 })
                    .style("opacity",1)
                    .transition()
                    .duration(1000)
                    .remove()

                    let hoursOfTheDay = [00,01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]

                    svg.selectAll('text')
                    .data(hoursOfTheDay)
                    .enter()
                    .append('text')
                    .attr("x", 1200)
	                .attr("y", 1200)
                    .style("fill","red")
                    .transition()
                    .delay(function (d, i) { return d * 1000 })
                    .text((d)=>{  return d })
                    .transition()
                    .duration(1000)
                    .remove()


                    
                    
                 })

            }
            
        </script>
    </body>

    </html>