<!DOCTYPE html>

<html>

    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script src="https://d3js.org/queue.v1.min.js"></script>
        <script src="https://d3js.org/d3-fetch.v1.min.js"></script>

        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <title>Delay Comparison </title>
    </head>

    <body >
        
        
        <div id = "Options">     
            <table >
                <tr><td><br></td></tr>
                <tr id="tableheader">
                    <td>
                        <h5>Visualisation</h5>
                        <div id="dropdownButtonVisulisation"></div>
                    </td>
                    <td>
                        <h5>Choose Org. Airport</h5>
                        <div id="dropdownButtonOrgAirport"></div>
                    </td>
                    <td>
                         <h5>Choose Dest. Airport</h5>
                        <div id="dropdownButtonDestAirport"></div>
                    </td>
                    <td>
                        <h5>Choose Hour</h5>
                        <div id="dropdownButtonHour"></div>
                    </td>
                   
                </tr>
            </table> 
           
        </div>
        <div id="legend"></div>
        <div id="Visualisation" width="100%" height="1000px"></div>
        
        


        <script type="text/javascript">
            var OrgAirport="ABE";
            var DestAirport="ATL"; 
            var Hour=-1; 

            var dropdownButtonVisulisation = d3.select("#dropdownButtonVisulisation")
                .append('select')
                
                dropdownButtonVisulisation 
                .selectAll('myOptions') 
                .data([{text:"Delay Comparison",value:"DelayComparison.html"},{text:"Delay at airports",value:"airports.html"},{text:"Delay from airlines",value:"airlines.html"},{text:"Connections",value:"connections.html"}])
                .attr("class","dropdown")
                .enter()
                .append('option')
                .text(function (d) { return d.text; }) 
                .attr("value", function (d) { return d.value; }) 

            dropdownButtonVisulisation.on("change", function(d) {
                let option = d3.select(this).property("value")
                
                open(option,"_self")
                })

            let Airportlink ="https://raw.githubusercontent.com/LauraKrone24/AbgabeDataVisualisation/master/SortedAirports.csv"
            d3.csv(Airportlink).then(airportData=>{
                var dropdownButtonOrgAirport = d3.select("#dropdownButtonOrgAirport")
                    .append('select')
                    
                    dropdownButtonOrgAirport
                    .selectAll('myOptions') 
                    .data(airportData)
                    .enter()
                    .append('option')
                    .text(function (d) { return d.IATA+" - "+d.AIRPORT; }) 
                    .attr("value", function (d) { return d.IATA; }) 

                    dropdownButtonOrgAirport.on("change", function(d) {
                    let option = d3.select(this).property("value")
                    OrgAirport = option;
                    
                    load()
                    })


                var dropdownButtonDestAirport = d3.select("#dropdownButtonDestAirport")
                    .append('select')
                    
                dropdownButtonDestAirport
                    .selectAll('myOptions') 
                    .data(airportData)
                    .enter()
                    .append('option')
                    .text(function (d) { return d.IATA+" - "+d.AIRPORT; }) 
                    .attr("value", function (d) { return d.IATA; }) 

                dropdownButtonDestAirport.on("change", function(d) {
                    let option = d3.select(this).property("value")
                    DestAirport = option;
                    
                    load()
                    })
                

                    
            })
            

            var dropdownButtonHour = d3.select("#dropdownButtonHour")
                .append('select')
                
            dropdownButtonHour
                .selectAll('myOptions') 
                .data([{text:"All Day",value:-1},{text:"00",value:0},{text:"01",value:1},{text:"02",value:2},{text:"03",value:3},{text:"04",value:4},{text:"05",value:5},{text:"06",value:6},{text:"07",value:7},{text:"08",value:8},{text:"09",value:9},{text:"10",value:10},{text:"11",value:11},{text:"12",value:12},{text:"13",value:13},{text:"14",value:14},{text:"15",value:15},{text:"16",value:16},{text:"17",value:17},{text:"18",value:18},{text:"19",value:19},{text:"20",value:20},{text:"21",value:21},{text:"22",value:22},{text:"23",value:23}])
                .enter()
                .append('option')
                .text(function (d) { return d.text; }) 
                .attr("value", function (d) { return d.value; }) 

            dropdownButtonHour.on("change", function(d) {
                let option = d3.select(this).property("value")
                Hour = option;
                
                load()
                })

           
            
            var myColor = d3.scaleLinear().domain([-60,0,60])
                    .range(["green","white", "red"])
            var array = [];

            for(let i = -60;i<60;i=i+0.1){
                array.push(i)
            }

            colorSvg = d3.select("#legend").append("svg")
            colorSvg.append("text")
                    .attr("class","LegendLable")
                    .attr("x",1170)
                    .attr("y",520)
                    .attr("fill","#222222")
                    .text("Delay in min")

            colorSvg.selectAll("rect")
            .data(array)
            .enter()
            .append("rect")
            .attr("x",(d,i)=>{return 1120+(d*2)})
            .attr("y",550)
            .attr("height",20)
            .attr("width",0.2)
            .attr("fill",(d)=>{return myColor(d)})

            var ColorX  = d3.scaleLinear()
                .domain([-60,60])
                .range([0,240]);

            colorSvg.append("g")
                    .attr("transform",
                            "translate(1000,550)")
                    .call(d3.axisTop(ColorX))
                    .attr("stroke", "#222222")
                            
            

        
            var svg = d3.select("#Visualisation")
                        .append("svg")
                            
                            
            
            load()
            function load()
            {
                
                

                var CSVLink ="https://raw.githubusercontent.com/LauraKrone24/AbgabeDataVisualisation/master/BestConnectSummary.csv"; 
                
                

                
                        
                        
                        
                d3.csv(CSVLink).then(data=>{
                    console.log(data)
                    svg.selectAll("*").remove()
                    data =  data.filter(element=>{
                        
                        return (element.OrgAirport==OrgAirport&&element.DestAirport==DestAirport&&parseInt(element.Hour) == Hour)
                    })
                    console.log(OrgAirport,DestAirport,data)

                    let count = data.length
                    let height = count *50;
                    var usedata = []
                    var max = 70;
                    var min = -10

                    data.forEach(element => {

                            max = max<parseFloat(element.MaxDelayOrg)?parseFloat(element.MaxDelayOrg):max;
                            max = max<parseFloat(element.MaxDelayDest)?parseFloat(element.MaxDelayDest):max;
                            min = min>parseFloat(element.MinDelayOrg)?parseFloat(element.MinDelayOrg):min;
                            min = min>parseFloat(element.MinDelayDest)?parseFloat(element.MinDelayDest):min;
                            
                            usedata.push({Title:element.Airline+" - Depature",MinDelay:element.MinDelayOrg,AvgDelay:element.AvgDelayOrg,MaxDelay:element.MaxDelayOrg})
                            usedata.push({Title:element.Airline+" - Destination",MinDelay:element.MinDelayDest,AvgDelay:element.AvgDelayDest,MaxDelay:element.MaxDelayDest})
                    });

                    min = Math.floor(min/10)*10-10
                    max = Math.ceil(max/10)*10+10

                    console.log(min,max)
                    console.log(usedata)
                    var x = d3.scaleLinear()
                    .domain([min, max])
                    .range([ 0, 1000]);

                    var y = d3.scaleBand()
                        .range([ 0, height ])
                        .domain(usedata.map(function(d) { return d.Title; }))
                        .padding(1);

                    if(count!=0){
                        svg.append("g")
                            .attr("transform", "translate(100," + (height+50) + ")")
                            .call(d3.axisBottom(x))

                        
                        
                        
                        svg.append("g")
                            .attr("transform", "translate(100,50)")
                            .call(d3.axisLeft(y))

                        svg.selectAll("myline")
                            .data(usedata)
                            .enter()
                            .append("line")
                            .attr("x1", (d)=>{ return x(d.MinDelay); })
                            .attr("x2", (d)=>{ return x(d.MaxDelay); })
                            .attr("y1", (d)=>{ return y(d.Title); })
                            .attr("y2", (d)=>{ return y(d.Title); })
                            .attr("stroke-width", "1px")
                            .attr("stroke","black")
                            .attr("transform", "translate(100,50)")

                        svg.selectAll("mycircle")
                            .data(usedata)
                            .enter()
                            .append("circle")
                            .attr("cx", (d)=>{ return x(d.MinDelay); })
                            .attr("cy", (d)=>{ return y(d.Title); })
                            .attr("r", "2.5")
                            .style("fill", (d)=>{return myColor(d.MinDelay)})
                            .attr("transform", "translate(100,50)")
                            .attr("stroke","black")
                            .attr("stroke-width", "0.2px")
                        
                        svg.selectAll("mycircle")
                            .data(usedata)
                            .enter()
                            .append("circle")
                            .attr("cx", (d)=>{ return x(d.MaxDelay); })
                            .attr("cy", (d)=>{ return y(d.Title); })
                            .attr("r", "2.5")
                            .style("fill", (d)=>{return myColor(d.MaxDelay)})
                            .attr("transform", "translate(100,50)")
                            .attr("stroke","black")
                            .attr("stroke-width", "0.2px")



                    }else{
                        
                        var Text = svg.append("text")
                        .attr("x",10)
                        .attr("y",100)
                        .text("There are no flights connectiong those two Airports ")



                    }
                    

                    })

            }

            

        
            
        </script>
    </body>

    </html>